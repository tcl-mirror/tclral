<html><head>
<title>ralutil - Ralutil Package</title>
<style type="text/css"><!--
    HTML {
	background: 	#FFFFFF;
	color: 		black;
    }
    BODY {
	background: 	#FFFFFF;
	color:	 	black;
    }
    DIV.doctools {
	margin-left:	10%;
	margin-right:	10%;
    }
    DIV.doctools H1,DIV.doctools H2 {
	margin-left:	-5%;
    }
    H1, H2, H3, H4 {
	margin-top: 	1em;
	font-family:	sans-serif;
	font-size:	large;
	color:		#005A9C;
	background: 	transparent;
	text-align:		left;
    }
    H1.title {
	text-align: center;
    }
    UL,OL {
	margin-right: 0em;
	margin-top: 3pt;
	margin-bottom: 3pt;
    }
    UL LI {
	list-style: disc;
    }
    OL LI {
	list-style: decimal;
    }
    DT {
	padding-top: 	1ex;
    }
    UL.toc,UL.toc UL, UL.toc UL UL {
	font:		normal 12pt/14pt sans-serif;
	list-style:	none;
    }
    LI.section, LI.subsection {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding: 	0em;
    }
    PRE {
	display: 	block;
	font-family:	monospace;
	white-space:	pre;
	margin:		0%;
	padding-top:	0.5ex;
	padding-bottom:	0.5ex;
	padding-left:	1ex;
	padding-right:	1ex;
	width:		100%;
    }
    PRE.example {
	color: 		black;
	background: 	#f5dcb3;
	border:		1px solid black;
    }
    UL.requirements LI, UL.syntax LI {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding:	0em;
    }
    DIV.synopsis {
	color: 		black;
	background: 	#80ffff;
	border:		1px solid black;
	font-family:	serif;
	margin-top: 	1em;
	margin-bottom: 	1em;
    }
    UL.syntax {
	margin-top: 	1em;
	border-top:	1px solid black;
    }
    UL.requirements {
	margin-bottom: 	1em;
	border-bottom:	1px solid black;
    }
--></style>
</head>
<! -- Generated from file 'ralutil.man' by tcllib/doctools with format 'html'
   -->
<! -- Copyright &copy; 2004 - 2014 by G. Andrew Mangogna
   -->
<! -- CVS: $Id$ ralutil.n
   -->
<body><div class="doctools">
<h1 class="title">ralutil(n) 0.11.3 ralutil &quot;Ralutil Package&quot;</h1>
<div id="name" class="section"><h2><a name="name">Name</a></h2>
<p>ralutil - Commands for the ralutil package</p>
</div>
<div id="toc" class="section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="toc">
<li class="section"><a href="#toc">Table Of Contents</a></li>
<li class="section"><a href="#synopsis">Synopsis</a></li>
<li class="section"><a href="#section1">Description</a></li>
<li class="section"><a href="#section2">VARIABLES</a></li>
<li class="section"><a href="#section3">COMMANDS</a></li>
<li class="section"><a href="#see-also">See Also</a></li>
<li class="section"><a href="#keywords">Keywords</a></li>
<li class="section"><a href="#copyright">Copyright</a></li>
</ul>
</div>
<div id="synopsis" class="section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="synopsis">
<ul class="requirements">
<li>package require <b class="pkgname">ral <span class="opt">?0.11.3?</span></b></li>
</ul>
<ul class="syntax">
<li><a href="#1"><b class="variable">::ralutil::DUM</b></a></li>
<li><a href="#2"><b class="variable">::ralutil::DEE</b></a></li>
<li><a href="#3"><b class="cmd">::ralutil::pipe</b> <i class="arg">script</i> <i class="arg"><span class="opt">?varName?</span></i> <i class="arg"><span class="opt">?sep?</span></i></a></li>
<li><a href="#4"><b class="cmd">::ralutil::crosstab</b> <i class="arg">relValue</i> <i class="arg">crossAttr</i> <i class="arg"><span class="opt">?attr1 attr2 ...?</span></i></a></li>
<li><a href="#5"><b class="cmd">::ralutil::rvajoin</b> <i class="arg">rel1</i> <i class="arg">rel2</i> <i class="arg">newAttr</i> <i class="arg"><span class="opt">?attr1 attr2 ...?</span></i></a></li>
<li><a href="#6"><b class="cmd">::ralutil::sysIdsInit</b></a></li>
<li><a href="#7"><b class="cmd">::ralutil::sysIdsGenSystemId</b> <i class="arg">relvarName</i> <i class="arg">attrName</i></a></li>
<li><a href="#8"><b class="cmd">::ralutil::attrConstraint</b> <i class="arg">relvarName</i> <i class="arg">attrExpr</i></a></li>
</ul>
</div>
</div>
<div id="section1" class="section"><h2><a name="section1">Description</a></h2>
<p>This manpage describes the <b class="package">ralutil</b> package.
The <b class="package">ralutil</b> package is a supplementary package to the
Tcl Relational Algebra Library (ral) package.</p>
</div>
<div id="section2" class="section"><h2><a name="section2">VARIABLES</a></h2>
<p>The <b class="package">ralutil</b> package defines two variables, <b class="variable">DUM</b> and <b class="variable">DEE</b>.
These two relation values play a special role as identity and
annihilator relations.</p>
<dl class="definitions">
<dt><a name="1"><b class="variable">::ralutil::DUM</b></a></dt>
<dd><p>The ordinary Tcl variable <b class="variable">::ralutil::DUM</b> contains a relation value
whose heading is empty and whose body is empty.</p></dd>
<dt><a name="2"><b class="variable">::ralutil::DEE</b></a></dt>
<dd><p>The ordinary Tcl variable <b class="variable">::ralutil::DEE</b> contains a relation value
whose heading is empty and whose body contains a single tuple that is the
empty tuple.</p></dd>
</dl>
</div>
<div id="section3" class="section"><h2><a name="section3">COMMANDS</a></h2>
<dl class="definitions">
<dt><a name="3"><b class="cmd">::ralutil::pipe</b> <i class="arg">script</i> <i class="arg"><span class="opt">?varName?</span></i> <i class="arg"><span class="opt">?sep?</span></i></a></dt>
<dd><p>The <b class="cmd">pipe</b> command provides a control structure to execute a sequence
of commands feeding the output of one command as the input to the next
one in the sequence.
The <i class="arg">script</i> argument is a sequence of commands separated by a
command separator character (by default &quot;|&quot;).
The script is rewritten and executed such that the return value of the first
command in the sequence is used as an argument to the next and so on for
all the commands in <i class="arg">script</i>.
The return value of a preceding command is inserted into the succeeding
command to replace the special argument substitution
character (default &quot;~&quot;).
If no argument substitution character is found in a command,
then the value is made the last argument of the command.
If the <i class="arg">varName</i> argument is present and not the empty string,
then the rewritten <i class="arg">script</i> is not executed
but rather is stored in the Tcl variable given by <i class="arg">varName</i>.
This is useful in loops where it is not necessary to recompute script
reorganization each time.
Executing <b class="cmd">eval</b> of the contents of <i class="arg">varName</i> can be used
to execute the rewritten script.
If the <i class="arg">sep</i> argument is present it is interpreted as a two character
string giving the command separator and argument place holder syntax
characters in that order.
By default these are &quot;|&quot; and &quot;~&quot; respectively, but different values may
be specified if these characters are otherwise present in the <i class="arg">script</i>
and would be misinterpreted in the script rewriting.
It is frequently the case that relational expressions take the output
of one command directly as the argument of another one.
This is easily done in Tcl because command evaluation may be nested
arbitrarily deep.
However, deeply nested commands can be difficult to read and follow.
The <b class="cmd">pipe</b> command is a control structure that allows deeply
nested commands to be written as a linear sequence.
This command was inspired by code from the Tcl wiki
<b class="sectref">http://wiki.tcl.tk/17419</b>.
The implementation is different than that found on the wiki,
but the idea is the same.
<em>N.B.</em> that here is nothing about the <b class="cmd">pipe</b> command that is
specific to relational algebra.
It can be used to sequence any Tcl commands.</p>
<p>To obtain a list of the breeds of all dogs whose name starts with &quot;S&quot;:</p>
<pre class="example">
set sdogs [::ralutil::pipe {
    relvar set DOG |
    relation restrictwith ~ {[string match S* $DogName]} |
    relation project ~ Breed |
    relation list
}]
</pre>
<p>The same command in natural Tcl nesting order is:</p>
<pre class="example">
set sdogs [relation list \ 
    [relation project \ 
        [[relation restrictwith \ 
            [relvar set DOG] \ 
        {[string match S* $DogName]}] \ 
    Breed]]]
</pre>
</dd>
<dt><a name="4"><b class="cmd">::ralutil::crosstab</b> <i class="arg">relValue</i> <i class="arg">crossAttr</i> <i class="arg"><span class="opt">?attr1 attr2 ...?</span></i></a></dt>
<dd><p>Generate a cross tabulation of <i class="arg">relValue</i> for the <i class="arg">crossAttr</i> attribute
against the optional <i class="arg">attrN</i> attributes.
Cross tabulations are sometimes known as <em>pivot</em> tables.
The result is relation value whose heading consists of the <i class="arg">attrN</i>
attributes plus a new attribute for each distinct value of the
<i class="arg">crossAttr</i> attribute.
The value of the new cross tabulated attributes is the number of tuples
in <i class="arg">relValue</i> that have the corresponding value of <i class="arg">crossAttr</i>.</p>
<pre class="example">
% set tab [::ralutil::crosstab [relvar set OWNERSHIP] Acquired]
% puts [relformat $tab]
+----+----+----+----+-----+
|2000|2001|2002|2003|Total|
|int |int |int |int |int  |
+----+----+----+----+-----+
|2   |3   |1   |1   |7    |
+----+----+----+----+-----+
% set tab [::ralutil::crosstab [relvar set OWNERSHIP] Acquired DogName]
% puts [relformat $tab]
+-------+----+----+----+----+-----+
|DogName|2000|2001|2002|2003|Total|
|string |int |int |int |int |int  |
+-------+----+----+----+----+-----+
|Fido   |0   |2   |0   |0   |2    |
|Sam    |2   |0   |0   |0   |2    |
|Spot   |0   |1   |0   |0   |1    |
|Rover  |0   |0   |1   |0   |1    |
|Fred   |0   |0   |0   |1   |1    |
+-------+----+----+----+----+-----+
</pre>
</dd>
<dt><a name="5"><b class="cmd">::ralutil::rvajoin</b> <i class="arg">rel1</i> <i class="arg">rel2</i> <i class="arg">newAttr</i> <i class="arg"><span class="opt">?attr1 attr2 ...?</span></i></a></dt>
<dd><p>The <b class="cmd">rvajoin</b> command
performs the relational equivalent to an <em>outer join</em>.
The idea is to end up
with a relation that contains a relation valued attribute which in turn
contains the
tuples that match in the join and is empty for those tuples in the
relation that do not match across the join attributes (the &quot;natural
join&quot; leaving such tuples out of the result altogether).
<i class="arg">rel1</i> is the first relation to join and
<i class="arg">rel2</i> is the second relation to join.
<i class="arg">newAttr</i> the name of the new relation valued attribute.
The remaining optional arguments are the attributes across which the join is
to be made.
If the no such arguments are given, then the join is performed across the
attributes that have the same name.
The result has the same heading as <i class="arg">rel1</i> plus an attribute <i class="arg">newAttr</i>.
The type of <i class="arg">newAttr</i> is <em>Relation</em> with a heading that matches
<i class="arg">rel2</i> minus the join attributes.
<em>N.B.</em> that <b class="cmd">rvajoin</b> is <em>not</em> commutative like the natural
join.
To show the difference between <b class="cmd">rvajoin</b> and natural join <em>i.e.</em>
<b class="cmd">relation join</b>,
consider the join of <b class="variable">Dog</b> to <b class="variable">Ownership</b>.
In this data set, Jumper the Mutt is not owned by anyone.
In the natural join, there is no tuple with Jumper.
The RVA join has a tuple for Jumper and an empty relation valued attribute
showing that Jumper is not owned.
It is also instructive to consider the effect of the <b class="cmd">ungroup</b> operation
on the RVA join which gives the same result as the natural join.</p>
<pre class="example">
% relformat [relation join $::DOG $::OWNERSHIP] &quot;Natural Join&quot;
+-------+---------+---------+--------+
|DogName|Breed    |OwnerName|Acquired|
|string |string   |string   |string  |
+-------+---------+---------+--------+
|Fido   |Poodle   |Sue      |2001    |
|Fido   |Poodle   |George   |2001    |
|Sam    |Collie   |Sue      |2000    |
|Sam    |Collie   |George   |2000    |
|Spot   |Terrier  |Alice    |2001    |
|Rover  |Retriever|Mike     |2002    |
|Fred   |Spaniel  |Jim      |2003    |
+-------+---------+---------+--------+
Natural Join
------------
% set j [rvajoin $::DOG $::OWNERSHIP OwnedBy]
% relformat $j &quot;RVA Join&quot;
+-------+---------+--------------------+
|DogName|Breed    |OwnedBy             |
|string |string   |Relation            |
+-------+---------+--------------------+
|Fido   |Poodle   |+---------+--------+|
|       |         ||OwnerName|Acquired||
|       |         ||string   |string  ||
|       |         |+---------+--------+|
|       |         ||Sue      |2001    ||
|       |         ||George   |2001    ||
|       |         |+---------+--------+|
|Sam    |Collie   |+---------+--------+|
|       |         ||OwnerName|Acquired||
|       |         ||string   |string  ||
|       |         |+---------+--------+|
|       |         ||Sue      |2000    ||
|       |         ||George   |2000    ||
|       |         |+---------+--------+|
|Spot   |Terrier  |+---------+--------+|
|       |         ||OwnerName|Acquired||
|       |         ||string   |string  ||
|       |         |+---------+--------+|
|       |         ||Alice    |2001    ||
|       |         |+---------+--------+|
|Rover  |Retriever|+---------+--------+|
|       |         ||OwnerName|Acquired||
|       |         ||string   |string  ||
|       |         |+---------+--------+|
|       |         ||Mike     |2002    ||
|       |         |+---------+--------+|
|Fred   |Spaniel  |+---------+--------+|
|       |         ||OwnerName|Acquired||
|       |         ||string   |string  ||
|       |         |+---------+--------+|
|       |         ||Jim      |2003    ||
|       |         |+---------+--------+|
|Jumper |Mutt     |+---------+--------+|
|       |         ||OwnerName|Acquired||
|       |         ||string   |string  ||
|       |         |+---------+--------+|
|       |         |+---------+--------+|
+-------+---------+--------------------+
RVA Join
--------
% relformat [relation ungroup $j OwnedBy] &quot;Ungrouping the Owned By Attribute&quot;
+-------+---------+---------+--------+
|DogName|Breed    |OwnerName|Acquired|
|string |string   |string   |string  |
+-------+---------+---------+--------+
|Fido   |Poodle   |Sue      |2001    |
|Fido   |Poodle   |George   |2001    |
|Sam    |Collie   |Sue      |2000    |
|Sam    |Collie   |George   |2000    |
|Spot   |Terrier  |Alice    |2001    |
|Rover  |Retriever|Mike     |2002    |
|Fred   |Spaniel  |Jim      |2003    |
+-------+---------+---------+--------+
Ungrouping the OwnedBy Attribute
--------------------------------
</pre>
</dd>
<dt><a name="6"><b class="cmd">::ralutil::sysIdsInit</b></a></dt>
<dd><p>The <b class="cmd">sysIdsInit</b> command initializes a scheme whereby attributes of
relvars can be given system generated identifiers.
This procedure should be invoked before requesting system generated
identifiers via <b class="cmd">sysIdGenSystemId</b>.</p></dd>
<dt><a name="7"><b class="cmd">::ralutil::sysIdsGenSystemId</b> <i class="arg">relvarName</i> <i class="arg">attrName</i></a></dt>
<dd><p>The <b class="cmd">sysIdGenSystemId</b> command requests that the <i class="arg">attrName</i>
attribute of the relvar, <i class="arg">relvarName</i>, be assigned a system generated
identifier.
This procedure uses relvar tracing to assign a unique integer value to
<i class="arg">attrName</i> when a tuple is inserted into <i class="arg">relvarName</i>.</p></dd>
<dt><a name="8"><b class="cmd">::ralutil::attrConstraint</b> <i class="arg">relvarName</i> <i class="arg">attrExpr</i></a></dt>
<dd><p>The <b class="cmd">attrConstraint</b> command
provides a simpler interface to relvar tracing.
It adds a variable trace for insert and update
on the given <i class="arg">relvarName</i>.
The trace
evaluates <i class="arg">attrExpr</i> and if true,
allows the insert or update to procede.
The expression may contain references to attribute names of the form
:&lt;attr name&gt;: (e.g. for an attribute called A1, &quot;expr&quot; may contain
tokens of the form, :A1:).
When the trace is evaluated, all of the attribute
attribute name tokens are replaced by the value of the attribute.
The intended use case is when you wish to constrain an attribute value
to be within some subrange of the data type. For example, if an int
typed attribute called, <b class="cmd">Status</b> should be greater than 0 and
less than 22, then</p>
<pre class="example">
attrConstraint myRelvar {:Status: &gt; 0 &amp;&amp; :Status: &lt; 22}
</pre>
<p>will install a variable trace on &quot;myRelvar&quot; to insure that each
insert or update to it has a proper value for &quot;Status&quot;.</p></dd>
</dl>
</div>
<div id="see-also" class="section"><h2><a name="see-also">See Also</a></h2>
<p>relation, relvar</p>
</div>
<div id="keywords" class="section"><h2><a name="keywords">Keywords</a></h2>
<p>relation, relvar, tuple</p>
</div>
<div id="copyright" class="section"><h2><a name="copyright">Copyright</a></h2>
<p>Copyright &copy; 2004 - 2014 by G. Andrew Mangogna</p>
</div>
</div></body></html>
